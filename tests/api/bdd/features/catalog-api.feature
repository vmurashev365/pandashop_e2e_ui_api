# language: ru
Функция: API Каталога товаров
  Как пользователь системы
  Я хочу иметь доступ к API каталога товаров
  Чтобы получать информацию о продуктах через API

  Предыстория:
    Дано API Pandashop.md доступно
    И заголовки запроса содержат "Content-Type: application/json"

  Сценарий: Получение списка товаров
    Когда я отправляю GET запрос на "/api/v1/products"
    Тогда код ответа должен быть 200
    И тело ответа содержит список товаров
    И каждый товар содержит обязательные поля:
      | поле         | тип    |
      | id           | string |
      | name         | string |
      | price        | number |
      | currency     | string |
      | availability | string |
    И время ответа не превышает 2000 мс

  Сценарий: Получение товара по ID
    Дано существует товар с ID "test-product-123"
    Когда я отправляю GET запрос на "/api/v1/products/test-product-123"
    Тогда код ответа должен быть 200
    И тело ответа содержит товар с ID "test-product-123"
    И товар содержит полную информацию:
      | поле        | обязательно |
      | id          | да          |
      | name        | да          |
      | description | да          |
      | price       | да          |
      | images      | да          |
      | category    | да          |
    И время ответа не превышает 1000 мс

  Сценарий: Получение несуществующего товара
    Когда я отправляю GET запрос на "/api/v1/products/non-existent-id"
    Тогда код ответа должен быть 404
    И тело ответа содержит сообщение об ошибке
    И заголовок "Content-Type" содержит "application/json"

  Сценарий: Поиск товаров по запросу
    Когда я отправляю GET запрос на "/api/v1/products/search" с параметрами:
      | параметр | значение |
      | query    | телефон  |
      | page     | 1        |
      | limit    | 20       |
    Тогда код ответа должен быть 200
    И тело ответа содержит результаты поиска
    И найденные товары содержат слово "телефон" в названии или описании
    И количество результатов не превышает 20
    И время ответа не превышает 3000 мс

  Сценарий: Поиск с пустым результатом
    Когда я отправляю GET запрос на "/api/v1/products/search" с параметрами:
      | параметр | значение              |
      | query    | несуществующийтовар123 |
    Тогда код ответа должен быть 200
    И тело ответа содержит пустой список товаров
    И общее количество результатов равно 0

  Сценарий: Фильтрация товаров по категории
    Дано существует категория "Электроника" с ID "electronics-123"
    Когда я отправляю GET запрос на "/api/v1/products" с параметрами:
      | параметр   | значение        |
      | categoryId | electronics-123 |
    Тогда код ответа должен быть 200
    И все товары в ответе принадлежат категории "electronics-123"

  Сценарий: Фильтрация товаров по цене
    Когда я отправляю GET запрос на "/api/v1/products" с параметрами:
      | параметр | значение |
      | priceMin | 100      |
      | priceMax | 500      |
    Тогда код ответа должен быть 200
    И все товары в ответе имеют цену от 100 до 500 MDL

  Схема сценария: Пагинация товаров
    Когда я отправляю GET запрос на "/api/v1/products" с параметрами:
      | параметр | значение   |
      | page     | <страница> |
      | limit    | <лимит>    |
    Тогда код ответа должен быть 200
    И в ответе содержится информация о пагинации:
      | поле       | значение   |
      | page       | <страница> |
      | limit      | <лимит>    |
      | total      | >= 0       |
      | totalPages | >= 1       |
    И количество товаров не превышает <лимит>

    Примеры:
      | страница | лимит |
      | 1        | 10    |
      | 2        | 20    |
      | 1        | 50    |

  Сценарий: Валидация некорректных параметров пагинации
    Когда я отправляю GET запрос на "/api/v1/products" с параметрами:
      | параметр | значение |
      | page     | 0        |
    Тогда код ответа должен быть 400
    И тело ответа содержит сообщение об ошибке валидации

  Сценарий: Получение категорий товаров
    Когда я отправляю GET запрос на "/api/v1/categories"
    Тогда код ответа должен быть 200
    И тело ответа содержит список категорий
    И каждая категория содержит поля:
      | поле | тип    |
      | id   | string |
      | name | string |
    И время ответа не превышает 1000 мс

  Сценарий: Проверка доступности API
    Когда я отправляю GET запрос на "/api/v1/health"
    Тогда код ответа должен быть 200
    И тело ответа содержит:
      | поле      | значение |
      | status    | healthy  |
      | timestamp | present  |
    И время ответа не превышает 500 мс

  Сценарий: Проверка CORS заголовков
    Когда я отправляю OPTIONS запрос на "/api/v1/products"
    Тогда код ответа должен быть 200
    И заголовки ответа содержат:
      | заголовок                   | значение |
      | Access-Control-Allow-Origin | *        |
      | Access-Control-Allow-Methods | GET, POST, PUT, DELETE |

  Сценарий: Обработка Rate Limiting
    Дано я отправил более 100 запросов за последнюю минуту
    Когда я отправляю GET запрос на "/api/v1/products"
    Тогда код ответа должен быть 429
    И заголовки ответа содержат:
      | заголовок           | присутствует |
      | X-RateLimit-Limit   | да           |
      | X-RateLimit-Remaining | да         |
      | Retry-After         | да           |
